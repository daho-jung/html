<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script>
        var c1, ctx_c1;
        var inFile, inImgArr;
        var inWidth,inHeight;
        var inImgData;
        function itit(){
            c1 = document.getElementById('c1');
            ctx_c1 = c1.getContext('2d');
        }

        function readRawImage(){
            inFile = document.getElementById('selectfile').files[0];

            inWidth = inHeight = Math.sqrt(inFile.size);
            inImgArr = new Array(inHeight);
            for(var i=0;i<inHeight;i++){
                inImgArr[i] = new Array(inWidth);
            }
            c1.width = inWidth;
            c1.height = inHeight; 
            var reader = new FileReader();
            reader.readAsBinaryString(inFile);
            reader.onload = function(){
                var bin = reader.result;
                for(var i=0;i<inHeight;i++){
                    for(var j=0;j<inWidth;j++){
                        var sPixel = (i*inHeight+j);
                        var ePixel = (i*inHeight +j)+1;
                        inImgArr[i][j] = bin.slice(sPixel,ePixel);
                    }
                }
                inImgData = ctx_c1.createImageData(inHeight,inWidth);
                for(var i=0;i<inHeight;i++){
                    for(var j=0;j<inWidth;j++){
                        var charValue = inImgArr[i][j].charCodeAt(0);
                        inImgData.data[(i*inWidth+j)*4+0] = charValue;
                        inImgData.data[(i*inWidth+j)*4+1] = charValue;
                        inImgData.data[(i*inWidth+j)*4+2] = charValue;
                        inImgData.data[(i*inWidth+j)*4+3] = 255;
                    }
                }
                ctx_c1.putImageData(inImgData,0,0);
            }
        }


        function addImage(){

            for(var i=0;i<inHeight;i++){
                for(var j=0;j<inWidth;j++){                        
                    inImgData.data[(i*inWidth+j)*4+3] += 10;
                    // inImgData.data[(i*inWidth+j)*4+1] += 10;
                    // inImgData.data[(i*inWidth+j)*4+2] += 10;
                }
            }
            ctx_c1.putImageData(inImgData,0,0);
        }
        function subImage(){
            for(var i=0;i<inHeight;i++){
                for(var j=0;j<inWidth;j++){                        
                    inImgData.data[(i*inWidth+j)*4+3] -= 10;
                }
            }
            ctx_c1.putImageData(inImgData,0,0);
        }

        function leftmirr(){
            for(var i=0;i<inHeight;i++){
                for(var j=0;j<inWidth;j++){  
                    var charValue = inImgArr[i][inWidth-j-1].charCodeAt(0);
                    inImgData.data[(i*inWidth+j)*4+0] = charValue;
                    inImgData.data[(i*inWidth+j)*4+1] = charValue;
                    inImgData.data[(i*inWidth+j)*4+2] = charValue;
                    inImgData.data[(i*inWidth+j)*4+3] = 255;    
                }
            }
            ctx_c1.putImageData(inImgData,0,0);
        }

        function upmirr(){
            for(var i=0;i<inHeight;i++){
                for(var j=0;j<inWidth;j++){  
                    var charValue = inImgArr[inHeight-i-1][j].charCodeAt(0);
                    inImgData.data[(i*inWidth+j)*4+0] = charValue;
                    inImgData.data[(i*inWidth+j)*4+1] = charValue;
                    inImgData.data[(i*inWidth+j)*4+2] = charValue;
                    inImgData.data[(i*inWidth+j)*4+3] = 255;    
                }
            }
            ctx_c1.putImageData(inImgData,0,0);
        }
        function b_and_w(){
            for(var i=0;i<inHeight;i++){
                for(var j=0;j<inWidth;j++){  
                    var charValue = inImgArr[i][j].charCodeAt(0);
                    if(charValue > 128)
                        charValue = 255;
                    else
                        charValue = 0;
                    inImgData.data[(i*inWidth+j)*4+0] = charValue;
                    inImgData.data[(i*inWidth+j)*4+1] = charValue;
                    inImgData.data[(i*inWidth+j)*4+2] = charValue;
                    inImgData.data[(i*inWidth+j)*4+3] = 255;    
                }
            }
            ctx_c1.putImageData(inImgData,0,0);
        }
        function shrink(){
            ctx_c1.clearRect(0,0,inWidth,inHeight);
            inImgData = ctx_c1.createImageData(inHeight/2,inWidth/2);
            c1.width = inWidth/2;
            c1.height = inHeight/2;
            hwidth = Math.floor(inWidth/2);
            hheight = Math.floor(inHeight/2);
                for(var i=0;i<hheight;i++){
                    for(var j=0;j<hwidth;j++){
                        var charValue = inImgArr[i*2][j*2].charCodeAt(0);
                        inImgData.data[(i*hwidth+j)*4+0] = charValue;
                        inImgData.data[(i*hwidth+j)*4+1] = charValue;
                        inImgData.data[(i*hwidth+j)*4+2] = charValue;
                        inImgData.data[(i*hwidth+j)*4+3] = 255;
                    }
                }
                ctx_c1.putImageData(inImgData,0,0);
        }

        function emph(){
            ctx_c1.clearRect(0,0,inWidth,inHeight);
            c1.width = inWidth*2;
            c1.height = inHeight*2;
            inImgData = ctx_c1.createImageData(inHeight*2,inWidth*2);
                for(var i=0;i<inHeight*2;i++){
                    for(var j=0;j<inWidth*2;j++){
                        var vi,vj;
                        vi = Math.floor(i/2);
                        vj = Math.floor(j/2);
                        var charValue = inImgArr[vi][vj].charCodeAt(0);
                        inImgData.data[(i*inWidth*2+j)*4+0] = charValue;
                        inImgData.data[(i*inWidth*2+j)*4+1] = charValue;
                        inImgData.data[(i*inWidth*2+j)*4+2] = charValue;
                        inImgData.data[(i*inWidth*2+j)*4+3] = 255;
                    }
                }
                ctx_c1.putImageData(inImgData,0,0);
        }

        function rot(){
            for(var i=0;i<inHeight;i++){
                for(var j=0;j<inWidth;j++){  
                    var charValue = inImgArr[inHeight-j-1][i].charCodeAt(0);
                    inImgData.data[(i*inWidth+j)*4+0] = charValue;
                    inImgData.data[(i*inWidth+j)*4+1] = charValue;
                    inImgData.data[(i*inWidth+j)*4+2] = charValue;
                    inImgData.data[(i*inWidth+j)*4+3] = 255;    
                }
            }
            ctx_c1.putImageData(inImgData,0,0);
        }
    </script>
</head>
<body onload="itit()">
    <canvas id='c1'></canvas>
    <br>
    <input type='file' id='selectfile' onchange='readRawImage()'/>
    <br>
    <input type='button' id='photoAdd' value='trans-' onclick='addImage()'/>
    <input type='button' id='photosub' value='trans+' onclick='subImage()'/><br>
    <input type='button' id='photoleft' value='leftmir' onclick='leftmirr()'/>
    <input type='button' id='photoup' value='upmir' onclick='upmirr()'/><br>
    <input type='button' id='b/w' value='b/w' onclick='b_and_w()'/>
    <input type='button' id='shrink' value='shrink' onclick='shrink()'/><br>
    <input type='button' id='emph' value='emph' onclick='emph()'/>
    <input type='button' id='rot' value='rot' onclick='rot()'/>

</body>
</html>